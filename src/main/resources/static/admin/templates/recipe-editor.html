<!-- Recipe Editor Section -->
<h2 class="mb-4">Recipe Management</h2>

<style>
    .ingredient-item {
        transition: background-color 0.2s;
        border-radius: 4px;
    }
    .ingredient-item:hover {
        background-color: #f8f9fa;
    }
    .ingredient-info {
        cursor: pointer;
        flex-grow: 1;
        padding: 0.25rem;
    }
    .ingredient-info:hover {
        background-color: #e9ecef;
        border-radius: 4px;
    }
    .ingredient-actions {
        opacity: 0.7;
    }
    .ingredient-actions:hover {
        opacity: 1;
    }

    /* Custom styling for the ingredient button group */
    .ingredient-btn-group .dropdown-toggle-split {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        width: auto !important;
        flex: 0 0 auto;
    }
    
    .ingredient-btn-group .btn:not(.dropdown-toggle-split) {
        flex: 1;
    }
    
    /* Conversion factor styling */
    .conversion-factor-item {
        transition: background-color 0.2s;
        border-radius: 4px;
        padding: 0.75rem;
        border-bottom: 1px solid #e9ecef;
        margin-bottom: 0.5rem;
    }

    .conversion-factor-info {
        min-width: 200px;
        padding-right: 1rem;
    }

    .nutritional-info {
        padding-left: 1rem;
        border-left: 1px solid #e9ecef;
    }

    .nutrition-facts {
        margin: 0;
        padding: 0;
    }

    /* Nutrition editor styling */
    .nutrition-editor {
        background-color: #f8f9fa;
        border-radius: 4px;
        padding: 0.5rem;
    }

    .nutrition-editor .input-group {
        max-width: 120px;
    }

    .nutrition-editor .input-group-text {
        min-width: 40px;
    }

    .nutrition-editor .form-control {
        text-align: right;
    }

    .nutrition-item {
        flex: 1;
        text-align: center;
        padding: 0.25rem 0.5rem;
        border-right: 1px solid #eee;
    }

    .nutrition-item:last-child {
        border-right: none;
    }

    /* Rest of existing styles remain unchanged */
</style>

<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">
            <i class="fas fa-utensils me-2"></i>
            Recipe List
        </h5>
    </div>
    <div class="card-body">
        <div class="alert alert-info">
            <p>
                <i class="fas fa-info-circle"></i>
                <strong>How to use the Recipe Manager:</strong>
            </p>
            <ol>
                <li>Click <strong>Load From Database</strong> to retrieve all recipes from your server database</li>
                <li>Create a new recipe with the <strong>New Recipe</strong> button or select an existing one from the list</li>
                <li>Fill in the recipe details (title, image URL, rating, instructions)</li>
                <li>Add ingredients by filling the ingredient form and clicking:
                    <ul>
                        <li><strong>Save</strong> to save and clear the form</li>
                        <li><strong>Save & New</strong> to save and immediately start a new ingredient</li>
                    </ul>
                </li>
                <li>To edit an ingredient, click on it in the ingredients list, modify the details, then save it</li>
                <li>Use the <strong>Conversion Factors</strong> section to set conversion values between different units for ingredients</li>
                <li>When finished, click <strong>Save Recipe</strong> to store your changes or <strong>Cancel</strong> to discard them</li>
                <li>Use <strong>Export Database</strong> to download all recipes as a JSON file</li>
                <li>Use <strong>Import From File</strong> to load recipes from a previously exported JSON file</li>
            </ol>
        </div>

        <div class="d-flex justify-content-start mb-4">
            <button id="newRecipeBtn" class="btn btn-success me-2">
                <i class="fas fa-plus"></i> New Recipe
            </button>
            <button id="loadFromDbButton" class="btn btn-info me-2">
                <i class="fas fa-database"></i> Load From Database
            </button>
            <input type="file" id="recipeFileInput" accept=".json" style="display: none;">
            <button id="loadFromFileButton" class="btn btn-primary me-2">
                <i class="fas fa-file-import"></i> Import From File
            </button>
            <button id="downloadJsonButton" class="btn btn-secondary">
                <i class="fas fa-download me-2"></i> Export Database
            </button>
        </div>
        
        <!-- Recipe Search and List -->
        <div class="input-group mb-3">
            <input type="text" class="form-control" id="mainRecipeSearchInput" placeholder="Search recipes...">
            <button class="btn btn-outline-secondary" type="button" id="mainRecipeSearchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>
        
        <div class="list-group" id="mainRecipeList">
            <!-- Recipes will be listed here -->
            <div class="alert alert-info" id="emptyRecipeListMessage">
                <i class="fas fa-info-circle me-2"></i>
                No recipes available. Create a new recipe or load from database.
            </div>
        </div>

        <!-- Hidden JSON storage (not visible to user) -->
        <textarea id="jsonEditor" style="display: none;"></textarea>
    </div>
</div>

<!-- Recipe Editor Modal -->
<div class="modal fade" id="recipeEditorModal" tabindex="-1" aria-labelledby="recipeEditorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title" id="recipeEditorModalLabel">Recipe Editor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Recipe Form -->
                <form id="recipeForm">
                    <!-- Recipe Details Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>Recipe Details
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="recipeTitle" class="form-label">Recipe Title</label>
                                <input type="text" class="form-control" id="recipeTitle" placeholder="Enter recipe title" required>
                            </div>

                            <div class="mb-3">
                                <label for="thumbnailUrl" class="form-label">Thumbnail URL</label>
                                <input type="url" class="form-control" id="thumbnailUrl" placeholder="Enter image URL">
                            </div>

                            <div class="mb-3">
                                <label for="rating" class="form-label">Rating (0-5)</label>
                                <input type="number" class="form-control" id="rating" min="0" max="5" step="0.1" placeholder="Enter rating">
                            </div>

                            <div class="mb-3">
                                <label for="instructions" class="form-label">Instructions</label>
                                <textarea class="form-control" id="instructions" rows="5" placeholder="Enter step-by-step instructions" required></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Ingredients Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-carrot me-2"></i>Ingredients
                            </h6>
                        </div>
                        <div class="card-body">
                            <div id="ingredientsList" class="mb-3">
                                <!-- Ingredient items will be added here dynamically -->
                            </div>

                            <div class="row g-3 align-items-end" id="ingredientForm">
                                <div class="col-md-4">
                                    <label for="ingredientName" class="form-label">Ingredient</label>
                                    <input type="text" class="form-control" id="ingredientName" list="existingIngredients" placeholder="Enter ingredient name">
                                    <datalist id="existingIngredients">
                                        <!-- Existing ingredient suggestions will appear here -->
                                    </datalist>
                                </div>
                                <div class="col-md-2">
                                    <label for="quantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="quantity" min="0.1" step="0.1" placeholder="Amount">
                                </div>
                                <div class="col-md-3">
                                    <label for="unit" class="form-label">Unit</label>
                                    <input type="text" class="form-control" id="unit" placeholder="Enter unit" list="unitSuggestions">
                                    <datalist id="unitSuggestions">
                                        <!-- Unit suggestions for the current ingredient will appear here -->
                                    </datalist>
                                </div>
                                <div class="col-md-3">
                                    <div class="btn-group w-100 ingredient-btn-group">
                                        <button type="button" id="saveIngredientBtn" class="btn btn-success">
                                            <i class="fas fa-save me-2"></i>Save
                                        </button>
                                        <button type="button" class="btn btn-success dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="visually-hidden">Toggle Dropdown</span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li><a class="dropdown-item" href="#" id="saveAndNewIngredientBtn">
                                                <i class="fas fa-plus me-2"></i>Save & New
                                            </a></li>
                                        </ul>
                                    </div>
                                </div>
                                <input type="hidden" id="editingIngredientIndex" value="-1">
                            </div>
                        </div>
                    </div>

                    <!-- Conversion Factors Section -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-exchange-alt me-2"></i>Conversion Factors
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                Conversion factors are automatically managed based on the recipe's ingredients.
                            </div>
                            
                            <div id="conversionFactorsList" class="mb-3">
                                <!-- Conversion factor items will be added here dynamically -->
                                <div id="emptyConversionFactorsMessage" class="alert alert-light">
                                    No conversion factors available for the current recipe's ingredients.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recipe Preview -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-eye me-2"></i>Recipe Preview
                            </h6>
                        </div>
                        <div class="card-body">
                            <div id="recipePreview" class="mt-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Complete the form above to see a preview of your recipe
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                <button type="button" id="saveRecipeBtn" class="btn btn-success">
                    <i class="fas fa-save me-2"></i> Save Recipe
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Recipe Selection Modal - Keep for backward compatibility -->
<div class="modal fade" id="recipeSelectionModal" tabindex="-1" aria-labelledby="recipeSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="recipeSelectionModalLabel">Select a Recipe to Edit</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="recipeSearchInput" placeholder="Search recipes...">
                    <button class="btn btn-outline-secondary" type="button" id="recipeSearchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="list-group" id="recipeList">
                    <!-- Recipes will be listed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
            </div>
        </div>
    </div>
</div>

<!-- Load JavaScript modules in the correct order -->
<script src="/admin/js/recipe-data.js"></script>
<script src="/admin/js/recipe-ui-core.js"></script>
<script src="/admin/js/recipe-ingredients-ui.js"></script>
<script src="/admin/js/recipe-conversion-ui.js"></script>
<script src="/admin/js/recipe-render.js"></script>
<script src="/admin/js/recipe-ui.js"></script>
<script src="/admin/js/recipe-io.js"></script>
<script src="/admin/js/recipe-form-handlers.js"></script>
<script src="/admin/js/recipe-ingredient-handlers.js"></script>
<script src="/admin/js/recipe-io-handlers.js"></script>
<script src="/admin/js/recipe-event-handlers.js"></script>
<script src="/admin/js/recipe-app-initializer.js"></script>
<script src="/admin/js/recipe-editor.js"></script>